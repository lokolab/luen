/**
 * Luen JavaScript library with a friendly API.
 *
 * Copyright (c) Krystian Pietruszka <kpietru@lokolab.net>
 * License MIT
 */

(function(g){var k=g.document;g.Luen=function(a){luen.assertType(a,"*");return this._initialize(a)};g.luen=g.$=function(a){luen.assertType(a,"*");return new Luen(a)};luen.VERSION="0.0.1";luen.REGEX_NOT_WHITE=/[\n\r\t\f]/g;luen.fn=Luen.prototype={query:"",context:void 0,length:0,_initialize:function(a){luen.assertType(a,"*");if(!a)return this;this.context=k;if("string"===typeof a)0<=a.indexOf("<")&&a.match(/^\s*(<[\w\W]+>)[^>]*$/)?(this.context=luen.parseDom("<luenRoot>"+a+"</luenRoot>"),a=luen.selector("luenRoot > *",
this.getContext())):(this.query=a,a=luen.selector(a,this.getContext(),!0));else if("object"===typeof a){if(a instanceof Luen)return a;this.context=a;if(!(a instanceof NodeList))if(a instanceof Node)a=[a];else throw new TypeError("Invalid type, must be a valid object.");}else{if("function"===typeof a)return this.ready(a);throw new TypeError("Invalid type, must be a string or a valid object.");}this.length=a.length;return this.extend(a)},find:function(a){luen.assertType(a,"string");this.getQuery()&&
"string"===typeof this.getQuery()?this.query=this.getQuery()+" "+a:this.query=a;a=luen.selector(this.getQuery(),this.getContext(),!0);this.length=a.length;return this.extend(a)},extend:function(a){luen.assertType(a,"object");return luen.extend(this,a)},ready:function(a){luen.assertType(a,"function");return this.on("DOMContentLoaded",a)},on:function(a,b){luen.assertType(a,"string");luen.assertType(b,"function");return this.each(function(){this.addEventListener(a,b)})},off:function(a,b){luen.assertType(a,
"string");luen.assertType(b,"function");return this.each(function(){this.removeEventListener(a,b)})},each:function(a){luen.assertType(a,"function");return luen.each(this,a)},getQuery:function(){return this.query},getContext:function(){return this.context},getLength:function(){return this.length},getName:function(){return!this[0]||1!==this[0].nodeType&&9!==this[0].nodeType?void 0:this[0].nodeName},is:function(a){luen.assertType(a,"string");a=a.substring(1);return this.hasProperty(a)?this.getProperty(a):
!1},hasProperty:function(a){luen.assertType(a,"string");return this[0]&&this[0]instanceof Node?a in this[0]:!1},setProperty:function(a,b){luen.assertType(a,"string");luen.assertType(b,"string","boolean","number");return this.each(function(){this[a]=b})},getProperty:function(a){luen.assertType(a,"string");return this.hasProperty(a)?this[0][a]:void 0},removeProperty:function(a){luen.assertType(a,"string");return this.each(function(){delete this[a]})},hasPropertyStyle:function(a){luen.assertType(a,"string");
return this[0]&&1===this[0].nodeType&&"style"in this[0]&&this[0].style[a]?!0:!1},setPropertyStyle:function(a,b){luen.assertType(a,"string","object");luen.assertType(b,"undefined","string");if("object"===typeof a)var c=a;else c={},c[a]=b;return this.each(function(){var a=this;luen.each(c,function(b,c){"style"in a||luen.extend(a,{style:{}});a.style[b]=c})})},getPropertyStyle:function(a){luen.assertType(a,"string");return this.hasPropertyStyle(a)?this[0].style[a]:void 0},hasComputedStyle:function(a,
b){luen.assertType(a,"string");luen.assertType(b,"undefined","string");if(!this[0]||1!==this[0].nodeType||this.getContext()!==k)return!1;var c=this[0].ownerDocument.defaultView.getComputedStyle(this[0],"undefined"===typeof b?null:b).getPropertyValue(a);return null===c||""===c?!1:!0},getComputedStyle:function(a,b){luen.assertType(a,"string");luen.assertType(b,"undefined","string");return this.hasComputedStyle(a,b)?this[0].ownerDocument.defaultView.getComputedStyle(this[0],"undefined"===typeof b?null:
b).getPropertyValue(a):void 0},hasCss:function(a,b){luen.assertType(a,"string");luen.assertType(b,"undefined","string");return this.hasPropertyStyle(luen._styleToCase(a))||this.hasComputedStyle(a,b)?!0:!1},setCss:function(a,b){luen.assertType(a,"string","object");luen.assertType(b,"undefined","string");if("object"===typeof a)var c=a;else c={},c[a]=b;return this.each(function(){var a=luen(this);luen.each(c,function(b,c){a.setPropertyStyle(luen._styleToCase(b),c)})})},getCss:function(a,b){luen.assertType(a,
"string");luen.assertType(b,"undefined","string");return this.hasPropertyStyle(luen._styleToCase(a))?this.getPropertyStyle(luen._styleToCase(a)):this.getComputedStyle(a,b)},hasAttribute:function(a){luen.assertType(a,"string");return this[0]&&1===this[0].nodeType?this[0].hasAttribute(a):!1},setAttribute:function(a,b){luen.assertType(a,"string");luen.assertType(b,"string");return this.each(function(){this.setAttribute(a,b)})},getAttribute:function(a){luen.assertType(a,"string");return this.hasAttribute(a)&&
null!==this[0].getAttribute(a)?this[0].getAttribute(a):void 0},removeAttribute:function(a){luen.assertType(a,"string");return this.each(function(){this.removeAttribute(a)})},hasClass:function(a){luen.assertType(a,"string");if(this[0]&&1===this[0].nodeType&&this[0].hasAttribute("class")){var b=this[0].getAttribute("class"),b=" "+b+" ".replace(luen.REGEX_NOT_WHITE," ");return 0>b.indexOf(" "+a.trim()+" ")?!1:!0}return!1},addClass:function(a){luen.assertType(a,"string");return this.each(function(){var b=
luen(this);if(!b.hasAttribute("class"))b.setAttribute("class",a.trim());else if(!b.hasClass(a)){var c=b.getAttribute("class"),c=" "+c+" ".replace(luen.REGEX_NOT_WHITE," ");b.setAttribute("class",c.trim()+" "+a.trim())}})},removeClass:function(a){luen.assertType(a,"string");return this.each(function(){var b=luen(this);if(b.hasClass(a)){var c=b.getAttribute("class"),c=" "+c+" ".replace(luen.REGEX_NOT_WHITE," "),c=c.replace(" "+a.trim()+" "," ");b.removeAttribute("class");b.setAttribute("class",c.trim())}})},
getOffset:function(){return this[0]&&1===this[0].nodeType?{top:this[0].offsetTop,left:this[0].offsetLeft,width:this[0].offsetWidth,height:this[0].offsetHeight}:void 0},insertBefore:function(a){luen.assertType(a,"string");var b=this[0];return luen(a).each(function(){b&&this.parentNode&&this.parentNode.insertBefore(b,this)})},insertAfter:function(a){luen.assertType(a,"string");var b=this[0];return luen(a).each(function(){b&&this.parentNode&&this.parentNode.insertBefore(b,this.nextSibling)})},prependTo:function(a){luen.assertType(a,
"string");var b=this[0];return luen(a).each(function(){b&&this.insertBefore(b,this.firstChild)})},appendTo:function(a){luen.assertType(a,"string");var b=this[0];return luen(a).each(function(){b&&this.appendChild(b)})},insertHtml:function(a,b){luen.assertType(b,"string");luen.assertType(a,"string");return this.each(function(){this.insertAdjacentHTML(a,b)})},setHtml:function(a){luen.assertType(a,"string");return this.each(function(){this.innerHTML=a})},addHtml:function(a){luen.assertType(a,"string");
return this.each(function(){this.innerHTML+=a})},getHtml:function(){return this[0]&&1===this[0].nodeType?this[0].innerHTML:void 0},getParent:function(){return this[0]&&1===this[0].nodeType?luen(this[0].parentNode):luen(null)},getChildren:function(){return this[0]&&1===this[0].nodeType?luen(this[0].childNodes):luen(null)},getPrev:function(){return this[0]&&1===this[0].nodeType?luen(this[0].previousElementSibling):luen(null)},getNext:function(){return this[0]&&1===this[0].nodeType?luen(this[0].nextElementSibling):
luen(null)},remove:function(){return this.each(function(a,b,c){this.parentNode.removeChild(this);c[a]=void 0})},show:function(a,b){luen.assertType(a,"undefined","string","number","function");luen.assertType(b,"undefined","number","function");return this.each(function(){var c=luen(this);c.setAttribute("data-luen-toggle","show");"number"===typeof a?luen.effects.fade.show(c,b):"string"===typeof a?luen.effects[a].show(c,b):"function"===typeof a?a(c,b):c.setPropertyStyle("display","")})},hide:function(a,
b){luen.assertType(a,"undefined","string","number","function");luen.assertType(b,"undefined","number","function");return this.each(function(){var c=luen(this);c.setAttribute("data-luen-toggle","hide");"number"===typeof a?luen.effects.fade.hide(c,b):"string"===typeof a?luen.effects[a].hide(c,b):"function"===typeof a?a(c,b):c.setPropertyStyle("display","none")})},toggle:function(a,b){luen.assertType(a,"undefined","string","number","function");luen.assertType(b,"undefined","number","function");return this.each(function(){var c=
luen(this);c.hasAttribute("data-luen-toggle")&&"show"!==c.getAttribute("data-luen-toggle")?c.show(a,b):c.hide(a,b)})},serialize:function(){var a=[];this.find("*").each(function(){var b=luen(this);if(!b.is(":disabled"))if(b.is(":selected")&&b.getParent().hasAttribute("name")&&"select"===b.getParent().getName().toLowerCase()){var c=b.getParent().getAttribute("name"),b=b.getProperty("value");a.push(encodeURIComponent(c)+"="+(null===b?"":encodeURIComponent(b)))}else b.hasAttribute("name")&&(b.is(":checked")||
"textarea"===b.getName().toLowerCase()||b.hasAttribute("type")&&!b.getAttribute("type").match(/^(radio|checkbox)$/i))&&(c=b.getAttribute("name"),b=b.getProperty("value"),a.push(encodeURIComponent(c)+"="+(null===b?"":encodeURIComponent(b))))});return a.join("&").replace(/%20/g,"+")},ajaxLoad:function(a,b,c){luen.assertType(a,"string");luen.assertType(b,"undefined","object","string","function");luen.assertType(c,"undefined","function");var d=this,e=a.indexOf(" "),h=-1<e?a.slice(0,e):a,f=-1<e?a.slice(e).trim():
null;"string"===typeof b?b=luen.parseParams(b):"function"===typeof b&&(c=b,b=void 0);luen.ajaxGet(h,b,function(a,b,e){var h=f?luen(a).find(f).getHtml():a,h=c?c(h,b,e):h;d.each(function(){luen(this).addHtml(h+"")})},"rawText");return this}};luen._styleToCase=function(a){luen.assertType(a,"string");return a.toLowerCase().replace(/-(.)/g,function(a,c){return c.toUpperCase()})};luen.extend=function(a,b){luen.assertType(a,"object");luen.assertType(b,"object");for(var c in b)b.hasOwnProperty(c)&&(a[c]=
b[c]);return a};luen.each=function(a,b){luen.assertType(a,"object");luen.assertType(b,"function");if(a instanceof Luen||Array.isArray(a))for(var c=a instanceof Luen?a.getLength():Object.keys(a).length,d=0;d<c&&!1!==b.call(a[d],d,a[d],a);d++);else for(d in a)if(!1===b.call(a[d],d,a[d],a))break;return a};luen.hasParam=function(a,b){luen.assertType(a,"string");luen.assertType(b,"undefined","string");return void 0===luen.getParam(a,b)?!1:!0};luen.getParam=function(a,b){luen.assertType(a,"string");luen.assertType(b,
"undefined","string");var c=b;"undefined"===typeof b&&(c=g.location.search.substring(1));for(var c=c.split("&"),d=0,e=c.length;d<e;d++){var h=c[d].split("=",2);if(decodeURIComponent(h[0])===a)return decodeURIComponent(h[1])}};luen.selector=function(a,b,c){luen.assertType(a,"string");luen.assertType(b,"undefined","object");luen.assertType(c,"undefined","boolean");var d=function(a){if(!a.match(/^[^:]+:.+$/))return a;a=a.split(":",2);return a[0].split("\\").join("")+"\\:"+a[1]};b=b?b:k;try{if(a&&"#"===
a[0]&&a.match(/^#[a-z]+[a-z0-9_-]*$/i))var e=b.getElementById(a.split("#",2)[1]),e=!0===c?[e]:e;else e=b.querySelectorAll(d(a))}catch(h){throw new SyntaxError(h.message+" @param query Invalid syntax: "+a);}return e};luen.parse=function(a,b){luen.assertType(a,"string");luen.assertType(b,"string");if(b.match("^(text|application)+/json$")){try{var c=JSON.parse(a)}catch(l){throw new SyntaxError("@param str Invalid "+b+": "+a);}return c}if(b.match("^(text|application)+/(xml|html|xhtml)$")){c=(new g.DOMParser).parseFromString(a,
b);if(c.getElementsByTagName("parsererror")[0])throw new SyntaxError("@param str Invalid "+b+": "+a);return c}if("params"===b){c={};if(""===a.trim())return c;for(var d=decodeURIComponent(a),d="?"===d.substring(0,1)?d.substring(1):d,d=d.split("&"),e=0,h=d.length;e<h;e++){var f=d[e].split("=");if(2!==f.length)throw new SyntaxError("@param str Invalid "+b+": "+a);c[f[0]]=f[1]}return c}throw new TypeError("@param type Invalid argument: "+b);};luen.parseXml=function(a){luen.assertType(a,"string");return luen.parse(a,
"text/xml")};luen.parseHtml=function(a){luen.assertType(a,"string");return luen.parse(a,"text/html")};luen.parseJson=function(a){luen.assertType(a,"string");return luen.parse(a,"text/json")};luen.parseParams=function(a){luen.assertType(a,"string");return luen.parse(a,"params")};luen.parseDom=function(a){luen.assertType(a,"string");return luen.parseHtml(a)};luen.jsonToString=function(a){luen.assertType(a,"object");try{var b=JSON.stringify(a)}catch(c){throw new SyntaxError("@param obj Invalid object. "+
c);}return b};luen.effects={fade:{show:function(a,b){luen.assertType(a,Luen);luen.assertType(b,"undefined","number","function");var c="number"===typeof b?b:350;a.setPropertyStyle("opacity","0");a.setPropertyStyle("display","");for(var d=1;100>=d;d++)(function(a,b,c){g.setTimeout(function(b,c){b.setPropertyStyle("opacity",""+a/100)},a*c/100,b,c)})(d,a,c);g.setTimeout(function(a,b){"function"===typeof b&&b(a)},c,a,b);return luen},hide:function(a,b){luen.assertType(a,Luen);luen.assertType(b,"undefined",
"number","function");var c="number"===typeof b?b:350;a.setPropertyStyle("opacity","1");for(var d=1;100>=d;d++)(function(a,b,c){g.setTimeout(function(b,c){b.setPropertyStyle("opacity",""+(100-a)/100)},a*c/100,b,c)})(d,a,c);g.setTimeout(function(a,b){a.setPropertyStyle("display","none");"function"===typeof b&&b(a)},c,a,b);return luen}},fadeX:{show:function(a,b){luen.assertType(a,Luen);luen.assertType(b,"undefined","number","function");var c="number"===typeof b?b:350;a.setPropertyStyle("position","");
a.setPropertyStyle("transition","opacity "+c+"ms");a.setPropertyStyle("opacity","1");a.setPropertyStyle("height","auto");a.setPropertyStyle("overflow","");g.setTimeout(function(a,b){"function"===typeof b&&b(a)},c,a,b);return luen},hide:function(a,b){luen.assertType(a,Luen);luen.assertType(b,"undefined","number","function");var c="number"===typeof b?b:350;a.setPropertyStyle("transition","opacity "+c+"ms");a.setPropertyStyle("opacity","0");g.setTimeout(function(a,b){a.setPropertyStyle("overflow","hidden");
a.setPropertyStyle("height","0");a.setPropertyStyle("position","absolute");"function"===typeof b&&b(a)},c,a,b);return luen}}};luen.ajax=function(a,b){luen.assertType(a,"string");luen.assertType(b,"undefined","object");"undefined"===typeof b&&(b={});var c={params:b.params||{},type:b.type||"rawText",method:b.method||"GET",error:b.error||function(){},success:b.success||function(){},headers:b.headers||{},mime:b.mime||null,timeout:b.timeout||0,username:b.username||null,password:b.password||null,cache:"cache"in
b&&!1===b.cache?!1:!0,async:!0};c.url=a;var d=c.params;if("object"===typeof c.params){var d=[],e;for(e in c.params)d.push(e+"="+c.params[e]);d=d.join("&")}if(!1===c.cache)var h=("_"in luen.parseParams(d)?"_-_=":"_=")+Date.now(),d=d?d+"&"+h:h;var f=new XMLHttpRequest;f.open(c.method,"POST"===c.method?c.url:c.url+(d?"?"+d:""),c.async,c.username,c.password);"POST"===c.method&&f.setRequestHeader("content-type","application/x-www-form-urlencoded; charset=utf-8");c.mime&&f.overrideMimeType(c.mime);for(e in c.headers)f.setRequestHeader(e,
c.headers[e]);return{done:function(a){luen.assertType(a,"undefined","function");"function"===typeof a&&(c.success=a);f.onreadystatechange=function(){if(4===f.readyState)if(200<=f.status&&300>f.status||304===f.status){if("rawXml"===c.type)var a=f.responseXML;else if("rawText"===c.type)a=f.responseText;else if("xml"===c.type)a=luen.parseXml(f.responseText);else if("json"===c.type)a=luen.parseJson(f.responseText);else if("html"===c.type)a=luen.parseHtml(f.responseText);else if("script"===c.type)eval(f.responseText);
else throw Error('@param opt.type Invalid ajax type "'+c.type+'".');c.success(a,f,c)}else throw c.error(f,c),Error(f.status+" "+f.statusText+" ("+c.url+")");};a=function(a,b,c){try{a.send("POST"===b.method?c:null)}catch(d){throw Error(d);}};c.async&&0<c.timeout?g.setTimeout(a,c.timeout,f,c,d):a(f,c,d);return f}}};luen.ajaxPost=function(a,b,c,d){luen.assertType(a,"string");luen.assertType(b,"undefined","string","object","function");luen.assertType(c,"undefined","string","function");luen.assertType(d,
"undefined","string");"function"===typeof b?(d=c,c=b,b=void 0):"string"===typeof b&&(d=b,c=function(){},b=void 0);return luen.ajax(a,{params:b,type:d,method:"POST"}).done(c)};luen.ajaxGet=function(a,b,c,d){luen.assertType(a,"string");luen.assertType(b,"undefined","string","object","function");luen.assertType(c,"undefined","string","function");luen.assertType(d,"undefined","string");"function"===typeof b?(d=c,c=b,b=void 0):"string"===typeof b&&(d=b,c=function(){},b=void 0);return luen.ajax(a,{params:b,
type:d,method:"GET"}).done(c)};luen.hasStorage=function(a){luen.assertType(a,"string");var b=g.localStorage.getItem(a),b=null===b?g.sessionStorage.getItem(a):b;try{var c=luen.parseJson(b)}catch(d){return!1}if("object"===typeof c&&"key"in c&&"engine"in c&&"luen"===c.engine&&"expires"in c&&"value"in c&&(b=c.expires+"","never"===b||"session"===b||b.match(/^[0-9]+$/)&&parseFloat(Date.now())<parseFloat(b)))return!0;luen.removeStorage(a);return!1};luen.setStorage=function(a,b,c){luen.assertType(a,"string");
luen.assertType(b,"string");luen.assertType(c,"undefined","number","string");"undefined"===typeof c?c="never":"session"!==c&&"never"!==c&&(c=parseFloat(Date.now())+parseFloat(c));b=luen.jsonToString({key:a,engine:"luen",expires:c,value:b});"session"===c?g.sessionStorage.setItem(a,b):g.localStorage.setItem(a,b);return luen};luen.getStorage=function(a){luen.assertType(a,"string");if(luen.hasStorage(a)){var b=g.localStorage.getItem(a);null===b&&(b=g.sessionStorage.getItem(a));try{var c=luen.parseJson(b).value}catch(d){return}return c+
""}};luen.removeStorage=function(a){luen.assertType(a,"string");g.localStorage.removeItem(a);g.sessionStorage.removeItem(a);return luen};luen.hasCookie=function(a){luen.assertType(a,"string");return void 0===luen.getCookie(a)?!1:!0};luen.setCookie=function(a,b,c,d,e,g){luen.assertType(a,"string");luen.assertType(b,"string");luen.assertType(c,"undefined","number","string");luen.assertType(d,"undefined","string");luen.assertType(e,"undefined","string");luen.assertType(g,"undefined","boolean");if(c){var f=
new Date;f.setTime(f.getTime()+1E3*parseFloat(c));c=f.toUTCString()}k.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+(c?"; expires="+c:"")+(d?"; path="+d:"")+(e?"; domain="+e:"")+(g?"; secure":"");return luen};luen.getCookie=function(a){luen.assertType(a,"string");a=encodeURIComponent(a)+"=";for(var b=k.cookie.split(";"),c=b.length,d=0;d<c;d++){var e=b[d];" "===e.charAt(0)&&(e=e.substring(1));if(0===e.indexOf(a))return decodeURIComponent(e.split(a,2)[1])}};luen.removeCookie=function(a,b,c){luen.assertType(a,
"string");luen.assertType(b,"undefined","string");luen.assertType(c,"undefined","string");k.cookie=encodeURIComponent(a)+"="+(b?"; path="+b:"")+(c?"; domain="+c:"")+"; expires=Thu, 01-Jan-70 00:00:01 GMT";return luen};luen.assertType=function(){for(var a=0,b=1,c=arguments.length;b<c;b++)if("*"===arguments[b]){a=0;break}else null===arguments[b]&&null===arguments[0]||"function"===typeof arguments[b]&&null!==arguments[b]&&arguments[0]instanceof arguments[b]||"string"===typeof arguments[b]&&typeof arguments[0]===
arguments[b]||a++;if(a===arguments.length-1)throw a=Array.prototype.slice.call(arguments),b=a.shift(),new TypeError('Invalid type "'+typeof b+'". Must be a "'+a.join('" or "')+'".');return arguments[0]}})(window);
